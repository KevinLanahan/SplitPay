<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SplitPay.com</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='static.css') }}" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&display=swap');
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <div class="top-nav">
    <div class="logo">SplitPay</div>
    <div class="nav-links">
      <a href="/">Home</a>
      <a href="/profile">Profile</a>
      <a href="/friends">Friends</a>
    </div>
    <div class="auth-buttons">
      {% if 'user_id' in session %}
        <a href="/logout">Log out</a>
      {% else %}
        <a href="/login">Log in</a>
        <a href="/signup" class="get-btn">Get SplitPay</a>
      {% endif %}
    </div>
  </div>

  <!-- Page Main Content -->
  <div class="page-content">
    <div class="form-section">
      <!-- üß≠ Tab Navigation -->
      <div class="tab-buttons">
        <button class="tab-button active" onclick="showTab('photo-tab', event)">Receipt Upload</button>
        <button class="tab-button" onclick="showTab('manual-tab', event)">Manual Entry</button>
      </div>

      <!-- üì∏ Receipt Upload Tab -->
      <div id="photo-tab" class="tab-content active">
        <h2>Upload Your Receipt</h2>
        <p>Use your camera or upload a photo of a receipt.</p>

        <form id="photo-form" enctype="multipart/form-data">
          <label for="receipt-upload">Upload a file</label><br />
          <input type="file" name="receipt" id="receipt-upload" accept="image/*" /><br /><br />
          <button type="submit">Analyze Receipt</button>
        </form>

        <div id="results"></div>
      </div>

      <!-- ‚úçÔ∏è Manual Entry Tab -->
      <div id="manual-tab" class="tab-content">
        <h2>‚úçÔ∏è Manual Entry</h2>
        <form id="manual-form">
          <!-- Who paid dropdown -->
          <label for="manual-payer"><strong>Who paid?</strong></label><br>
          <select id="manual-payer" required style="padding: 5px; font-family: 'Open Sans', sans-serif; font-size: 14px; margin-bottom: 15px;">
            <!-- Populated by JS -->
          </select>
      
          <!-- Item inputs will go here -->
          <div id="manual-items" style="margin-bottom: 12px;"></div>
      
          <!-- Add item button -->
          <button type="button" id="add-manual-item" class="add-btn">+ Add Item</button>
      
          <!-- Total -->
          <div id="manual-total" style="margin-top: 10px; font-weight: bold;"></div>
      
          <!-- Submit button -->
          <button type="submit" style="margin-top: 16px;">Calculate Split</button>
        </form>
      
        <div id="manual-results" style="margin-top: 20px;"></div>
      </div>
      
    </div>

    <!-- Transaction History -->
    <div class="transaction-history">
      <div class="history-panel">
        <h3>Transaction History</h3>
        <ul id="history-list">
          {% for txn in transactions %}
            <li>
              {{ 'You paid' if txn.payer == user_email else txn.payer + ' paid you' }}
              ${{ "%.2f"|format(txn.amount) }} on {{ txn.date }}
            </li>
          {% else %}
            <li>No transactions yet</li>
          {% endfor %}
        </ul>        
      </div>
    </div>
  </div>
<!-- Define user + friends from Flask for script.js -->
<script>
  window.manualUser = "{{ user_email }}";
  window.manualFriends = {{ friend_names | tojson }};
</script>

<!-- Then load your scripts -->
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script src="{{ url_for('static', filename='script.js') }}"></script>

</body>
</html>
