<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&family=Manrope:wght@400;500;700;800&family=Noto+Sans:wght@400;500;700;900"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"
    />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style>
      .choices__list--dropdown .choices__item {
        display: flex;
        align-items: center;
        padding-left: 0.75rem;
      }
      .choices__list--dropdown input[type="checkbox"] {
        pointer-events: none;
      }
      .group-btn {
        cursor: pointer;
      }
      .group-btn:hover {
        text-decoration: underline;
      }
    </style>

    <title>SplitPay</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
  </head>
  <body class="bg-[#f8fcfa] font-[Manrope,Noto Sans,sans-serif]">
    <div class="min-h-screen flex flex-col">
      <!-- ðŸ”· Header/Nav -->
      <header class="flex items-center justify-between border-b border-[#e6f4ef] px-10 py-3">
        <div class="flex items-center gap-4 text-[#0c1c17]">
          <div class="size-4">
            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M24 45.8C19.7 45.8 15.5 44.5 11.9 42.1C8.3 39.7 5.5 36.3 3.9 32.3C2.2 28.4 1.8 24 2.6 19.7C3.5 15.5 5.5 11.6 8.6 8.6C11.6 5.5 15.5 3.5 19.7 2.6C24 1.8 28.4 2.2 32.3 3.9C36.3 5.5 39.7 8.3 42.1 11.9C44.5 15.5 45.8 19.7 45.8 24L24 24V45.8Z" fill="currentColor"/>
            </svg>
          </div>
          <h2 class="text-lg font-bold tracking-tight">SplitPay</h2>
        </div>
        <div class="flex items-center gap-9">
          <nav class="flex items-center gap-8 text-sm font-medium text-[#0c1c17]">
            <a href="/">Home</a>
            <a href="/profile">Profile</a>
            <a href="/friends">Friends</a>
            <a href="/billing">Billing</a>
            <a href="/my_invites">Group Invites</a>
          </nav>
          <div class="flex items-center gap-4">
            <button class="h-10 w-10 rounded-lg bg-[#e6f4ef] flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256">
                <path d="M221.8,175.94C216.25,166.38,208,139.33,208,104a80,80,0,1,0-160,0c0,35.34-8.26,62.38-13.81,71.94A16,16,0,0,0,48,200H88.81a40,40,0,0,0,78.38,0H208a16,16,0,0,0,13.8-24.06ZM128,216a24,24,0,0,1-22.62-16h45.24A24,24,0,0,1,128,216Z"/>
              </svg>
            </button>
            <div class="size-10 rounded-full bg-cover bg-center" style='background-image: url("https://lh3.googleusercontent.com/a-/AOh14GhN")'></div>
          </div>
        </div>
      </header>

      <!-- ðŸ“„ Main Content -->
      <main class="flex flex-col md:flex-row px-10 py-8 gap-10">
        <!-- ðŸ’¸ Split UI -->
        <section class="flex-1 max-w-2xl mx-auto">
          <h2 class="text-[28px] font-bold text-center pb-5">Split expenses effortlessly</h2>
          <div class="flex gap-3 justify-center">
            <button id="receipt-btn" class="bg-[#019863] text-white px-4 py-2 rounded-lg font-bold">Receipt Upload</button>
            <button id="manual-btn" class="bg-[#e6f4ef] text-[#0c1c17] px-4 py-2 rounded-lg font-bold">Manual Entry</button>
          </div>

          <form id="manual-entry-form" class="mt-6 flex flex-col gap-3 hidden">
            <!-- Hidden field for user's email -->
            <input type="hidden" id="user-email" value="{{ user_email }}">
            <input type="hidden" id="user-full-name" value="{{ user_full_name }}">

            <!-- Group Selector -->
            <label for="group-select" class="font-semibold">Select Group (optional)</label>
            <select id="group-select" class="border rounded p-2">
              <option value="">-- None --</option>
              {% for group in user_groups %}
                <option value="{{ group[0].id }}">{{ group[0].name }}</option>
              {% endfor %}
            </select>

            <!-- Item Name -->
            <label for="manual-item-name" class="font-semibold">Item Name</label>
            <input type="text" id="manual-item-name" class="border rounded p-2" placeholder="e.g. Pizza">

            <!-- Item Price -->
            <label for="manual-item-price" class="font-semibold">Item Price</label>
            <input type="number" id="manual-item-price" class="border rounded p-2" placeholder="e.g. 12.99" step="0.01" min="0">

            <!-- Owner Selector -->
            <label for="manual-owners" class="font-semibold">Select Owners</label>
            <select id="manual-owners" class="border rounded p-2" multiple>
              <option value="{{ user_email }}">{{ user_full_name }}</option>
              {% for friend in friends %}
                <option value="{{ friend.email }}">{{ friend.full_name }}</option>
              {% endfor %}
            </select>

            <!-- Add Item Button -->
            <button type="button" id="add-manual-item" class="bg-[#019863] text-white px-4 py-2 rounded-lg font-bold w-fit">Add Item</button>

            <!-- Manual Items List -->
            <ul id="manual-items-list" class="space-y-2 pt-2"></ul>

            <!-- Final Submit -->
            <button type="button" id="submit-manual-items" class="bg-[#019863] text-white px-4 py-2 rounded-lg font-bold w-fit">Calculate Split</button>
          </form>

          <!-- ðŸ“¤ Receipt Upload Form -->
          <form id="photo-form" enctype="multipart/form-data" class="mt-6 flex flex-col gap-3">
            <!-- Group Selector -->
            <label for="upload-group-select" class="font-semibold">Select Group (optional)</label>
            <select id="upload-group-select" class="border rounded p-2">
              <option value="">-- No Group --</option>
              {% for group, count in user_groups %}
                <option value="{{ group.id }}">{{ group.name }}</option>
              {% endfor %}
            </select>

            <!-- File Input -->
            <label class="font-semibold">Upload Receipt Image</label>
            <input type="file" id="receipt-upload" name="receipt" accept="image/*" class="file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-[#e6f4ef] file:text-[#0c1c17] hover:file:bg-[#d3ece3]" />

            <button type="submit" class="bg-[#019863] text-white px-4 py-2 rounded-lg font-bold max-w-[200px]">Upload</button>
          </form>

          <!-- ðŸ”½ Dynamic Results Appear Here -->
          <div id="results" class="mt-6 space-y-4"></div>

          <!-- âœ… Receipt Owner Assignment UI -->
          <div id="receipt-item-entry" class="mt-6 flex flex-col gap-4 hidden">
            <h3 class="text-xl font-bold">Assign Owners</h3>
            <p class="text-sm text-gray-600">Select who shared each item. Tax will be split among selected item owners automatically.</p>
            <ul id="receipt-items-list" class="space-y-4"></ul>
            <button type="button" id="split-items-btn" class="bg-[#019863] text-white px-4 py-2 rounded-lg font-bold w-fit">Split Items</button>
            <div class="mt-4">
              <label for="receipt-paid-by" class="block font-semibold">Who Paid?</label>
              <select id="receipt-paid-by" class="border rounded w-full p-2 mt-1"></select>
            </div>
            <div id="final-split-result" class="pt-2 text-sm font-semibold text-green-700"></div>
          </div>
        </section>

        <!-- ðŸ“Œ Sidebar -->
         
        <aside class="w-full md:w-80 space-y-6">
          <div class="bg-white rounded-lg p-4 shadow-sm border">
            <h3 class="font-bold text-lg mb-2">Your Groups</h3>
            <ul class="space-y-1 text-sm">
              {% for group, count in user_groups %}
                <li 
                  class="group-btn text-[#0c1c17] hover:underline cursor-pointer"
                  data-group-id="{{ group.id }}"
                >
                  {{ group.name }} ({{ count }} member{{ 's' if count != 1 else '' }})
                </li>
              {% endfor %}
            </ul>
            
            <div id="group-panel" class="mt-4 hidden text-sm text-[#0c1c17]"></div>
            <button id="create-group-btn" class="mt-3 text-[#019863] font-semibold">+ Create New Group</button>


          </div>

          <div class="bg-white rounded-lg p-4 shadow-sm border">
            <h3 class="font-bold text-lg mb-2">Transaction History</h3>
            <ul id="transaction-history" class="text-sm space-y-1">
              {% for txn in transactions %}
                <li>
                  You were paid ${{ "%.2f"|format(txn.amount) }} on {{ txn.date }}
                </li>
              {% else %}
                <li id="no-transactions">No transactions yet</li>
              {% endfor %}
            </ul>
          </div>
        </aside>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>




